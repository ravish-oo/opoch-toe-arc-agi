# WO-00-lite (add now, beneath WO-01)

## What it adds (and why)

1. **`receipts.py`** — a tiny aggregator so WO-01 can log and you can “debug as algebra.”
2. **`determinism.py`** — a local script to permute train order and compare receipt hashes.
3. **`harness.py` (stub)** — minimal runner to set a `task_id`, call module self-checks, finalize receipts, print the hash.

That’s it. No docs boilerplate, no CI.

## Exact surfaces (tight, no stubs)

### `src/receipts.py` (≈80 LOC)

* `init(task_id: str) -> None`
  reset in-memory state; store `task_id`, fixed schema version `"1.0.0"`.
* `log(section: str, payload: dict) -> None`
  update `state["sections"][section] = payload` (overwrite by section).
* `finalize() -> dict`
  return canonical dict: `{"version":"1.0.0","task_id":..., "sections":..., "extras":{}}` with keys sorted (you’ll rely on canonicalization in hash).
* `hash_receipts(doc: dict) -> str`
  JSON dump with sorted keys and no spaces, SHA-256 hex.

Notes:

* Ignore unknown fields; never crash.
* No timestamps; determinism relies on byte-stable JSON.

### `src/harness.py` (≈50 LOC)

* Minimal CLI:

  * `--task-id <id>` default `dev.morphisms`
  * `--selfcheck morphisms` to trigger only WO-01 self-check
  * Behavior: `receipts.init(task_id)`, import the module, call its `init()` or just import-time self-check, `doc=receipts.finalize()`, print hash and the `sections` keys present.

### `scripts/determinism.py` (≈40–60 LOC)

* Accepts `--runs 2` and `--shuffle` flag (no I/O with ARC yet).
* Runs `harness.py` twice with the same `task_id`, collects two hashes, prints `OK` if equal, else prints both JSON blobs (to diff).
* Seed any randomness before import (`random.seed(1337)`, `numpy.random.seed(1337)` if you ever use numpy later).

## How you’ll use it immediately (with WO-01)

* Run: `python -m src.harness --task-id dev.morphisms --selfcheck morphisms`
* You’ll see:

  * sections: `["morphisms"]`
  * hash: `a4f…`
* For determinism: `python scripts/determinism.py` → `OK`.
* If WO-01 algebra fails, `sections["morphisms"]["examples"]` contains the counterexample. That’s your “debug = algebra.”

## Acceptance (for WO-00-lite)

* `receipts.init/log/finalize/hash_receipts` exist and are pure.
* `harness --selfcheck morphisms` prints a stable hash across runs.
* `determinism.py` prints `OK`.
* No TODOs; no external deps.

---